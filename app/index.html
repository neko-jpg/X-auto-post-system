<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📸 イベント写真自動投稿</title>
    <link rel="stylesheet" href="styles.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Inter:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <!-- Cropper.js for image editing -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
    <script type="module" src="event-patterns.js"></script>
    <script type="module" src="comment-rules.js"></script>
    <script type="module" src="bulk-text-parser.js"></script>
    <script type="module" src="storage-adapter.js"></script>
    <script type="module" src="state-manager.js"></script>
    <script type="module" src="person-database.js"></script>
    <script type="module" src="autocomplete-engine.js"></script>
    <script type="module" src="autocomplete-ui.js"></script>
    <script type="module" src="template-database.js"></script>
    <script type="module" src="template-ui.js"></script>
    <script type="module" src="history-database.js"></script>
    <script type="module" src="history-ui.js"></script>
    <script type="module" src="inline-edit.js"></script>
    <script type="module" src="status-indicator.js"></script>
    <script type="module" src="quick-preview.js"></script>
    <script type="module" src="context-menu.js"></script>
    <script type="module" src="selection-mode.js"></script>
    <script type="module" src="focus-manager.js"></script>
    <script type="module" src="touch-gestures.js"></script>
    <script type="module" src="preview-editor.js"></script>
    <script type="module" src="image-editor.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <h1>📸 イベント写真自動投稿 (LEGACY)</h1>
            <div
                style="background: #ef4444; color: white; padding: 10px; border-radius: 8px; margin: 10px 0; font-weight: bold; text-align: center;">
                ⚠️ 旧バージョンを表示中です。<br>
                UI/UXが刷新された新バージョンは <a href="http://localhost:3000"
                    style="color: white; text-decoration: underline;">http://localhost:3000</a> を開いてください。
            </div>
            <p class="subtitle">TGS / レース / 展示会</p>
        </header>

        <!-- Step Indicator (Clickable) -->
        <div class="step-indicator">
            <button class="step active" id="step1-indicator" onclick="window.goToStep && window.goToStep(1)">
                <span class="step-number">1</span>
                <span class="step-label">イベント設定</span>
            </button>
            <div class="step-line"></div>
            <button class="step" id="step2-indicator" onclick="window.goToStep && window.goToStep(2)">
                <span class="step-number">2</span>
                <span class="step-label">写真投稿</span>
            </button>
        </div>

        <!-- Breadcrumb Navigation (Removed - using clickable step indicators instead) -->

        <!-- Step 1: Event Setup -->
        <section class="step-panel active" id="step1-panel">
            <div class="panel-header">
                <h2>📄 イベント情報を設定</h2>
                <p>テキスト貼り付け・ファイル読込・手動入力から選択</p>
            </div>

            <!-- Input Method Tabs -->
            <div class="input-tabs">
                <button class="input-tab active" data-tab="paste">📋 テキスト貼り付け</button>
                <button class="input-tab" data-tab="file">📄 ファイル読込</button>
                <button class="input-tab" data-tab="manual">✏️ 手動入力</button>
            </div>

            <!-- Tab: Text Paste (ChatGPT output) -->
            <div class="tab-content active" id="paste-tab">
                <div class="paste-section">
                    <textarea id="paste-input" rows="6" placeholder="ChatGPTの出力をここに貼り付け...

例:
イベント名: TOKYO GAME SHOW 2025
日本語名: 東京ゲームショウ2025
日付: 2025.09.25-28
会場: 幕張メッセ
ハッシュタグ: #TGS2025 #イベコン"></textarea>
                    <button class="btn btn-primary" id="parse-paste-btn">
                        🔍 解析してキューへ追加 →
                    </button>
                    <div class="parse-result" id="parse-result"></div>
                </div>
            </div>

            <!-- Tab: File Drop -->
            <div class="tab-content" id="file-tab">
                <div class="drop-zone" id="event-drop-zone">
                    <div class="drop-zone-content">
                        <span class="drop-icon">📄</span>
                        <p>event_info.txt をドラッグ&ドロップ</p>
                        <span class="drop-or">または</span>
                        <input type="file" id="event-file-input" accept=".txt" hidden>
                        <button class="btn btn-secondary" onclick="document.getElementById('event-file-input').click()">
                            ファイルを選択
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tab: Manual Input -->
            <div class="tab-content" id="manual-tab">

                <!-- Manual Input Form -->
                <form class="event-form" id="event-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="event-en">イベント名（英語）</label>
                            <input type="text" id="event-en" placeholder="TOKYO GAME SHOW 2025">
                        </div>
                        <div class="form-group">
                            <label for="event-jp">イベント名（日本語）</label>
                            <input type="text" id="event-jp" placeholder="東京ゲームショウ2025">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="event-date">開催日</label>
                            <input type="text" id="event-date" placeholder="2025.09.25 - 28">
                        </div>
                        <div class="form-group">
                            <label for="event-venue">会場</label>
                            <input type="text" id="event-venue" placeholder="幕張メッセ">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="event-category">カテゴリ</label>
                            <select id="event-category">
                                <option value="ブース">ブース</option>
                                <option value="チーム">チーム</option>
                                <option value="出展">出展</option>
                                <option value="サーキット">サーキット</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="event-hashtags">ハッシュタグ</label>
                            <input type="text" id="event-hashtags" placeholder="#TGS2025 #イベントコンパニオン">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary btn-large">
                        ✓ 確定して写真投稿へ →
                    </button>
                </form>
            </div>
        </section>

        <!-- Step 2: Post Queue -->
        <section class="step-panel" id="step2-panel">
            <!-- Event Summary Bar -->
            <div class="event-summary" id="event-summary">
                <div class="event-info">
                    <span class="event-icon">📍</span>
                    <div class="event-details">
                        <strong id="summary-event-name">TOKYO GAME SHOW 2025 – 東京ゲームショウ2025</strong>
                        <span id="summary-event-meta">2025.09.25-28｜幕張メッセ</span>
                    </div>
                </div>
                <button class="btn btn-ghost btn-small" id="change-event-btn">← イベント情報を変更</button>
            </div>

            <!-- Quick Add Section -->
            <div class="quick-add-section">
                <div class="quick-add-drop" id="quick-add-drop">
                    <input type="file" id="photo-file-input" accept="image/*" multiple hidden>
                    <div class="quick-add-content">
                        <span class="quick-add-icon">📷</span>
                        <span class="quick-add-text">写真をドロップして投稿を追加（最大10枚）</span>
                        <span class="quick-add-count" id="queue-count">0 / 10</span>
                    </div>
                </div>
                <div class="quick-add-actions">
                    <button class="btn btn-secondary" onclick="document.getElementById('photo-file-input').click()">
                        📷 写真を選択
                    </button>
                    <button class="btn btn-ghost" id="add-empty-btn">
                        ➕ 空の投稿を追加
                    </button>
                    <button class="btn btn-ghost" id="open-history-btn">
                        📜 履歴
                    </button>
                </div>
            </div>

            <!-- Post Queue -->
            <div class="post-queue-section">
                <div class="queue-header">
                    <h3>📝 投稿キュー</h3>
                    <div class="queue-completion-bar" id="queue-completion-bar">
                        <div class="completion-bar-label">
                            <span>完了率</span>
                            <span id="completion-percentage">0%</span>
                        </div>
                        <div class="completion-bar-container">
                            <div class="completion-bar-fill" id="completion-bar-fill"></div>
                        </div>
                    </div>
                    <div class="queue-actions-header">
                        <button class="btn btn-ghost btn-small" id="batch-generate-btn">✨ 一括コメント生成</button>
                        <button class="btn btn-ghost btn-small" id="clear-all-btn">🗑️ 全てクリア</button>
                        <button class="btn btn-primary btn-small" id="send-all-btn">📤 一括送信</button>
                    </div>
                </div>

                <div class="post-queue" id="post-queue">
                    <!-- Queue items will be rendered here by JavaScript -->
                    <div class="queue-empty" id="queue-empty">
                        <span class="queue-empty-icon">📭</span>
                        <p>投稿がありません</p>
                        <p class="queue-empty-hint">写真をドロップするか、「空の投稿を追加」をクリック</p>
                    </div>
                </div>
            </div>

            <!-- Live Preview (for current/selected post) -->
            <div class="preview-section" id="live-preview-section" style="display: none;">
                <h3>📄 プレビュー</h3>
                <div class="preview-cards">
                    <div class="preview-card preview-card-full">
                        <div class="preview-header">
                            <span class="preview-icon">📝</span>
                            <span class="preview-title">ドラフト</span>
                        </div>
                        <div class="preview-content" id="preview-x1"></div>
                        <button class="btn btn-copy" onclick="copyPreviewText('preview-x1')">📋 コピー</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Edit Post Modal (Full Screen) -->
        <div class="modal fullscreen-modal" id="edit-post-modal">
            <div class="fullscreen-modal-content">
                <!-- Header with tabs -->
                <div class="fullscreen-header">
                    <div class="fullscreen-title">
                        <h2 id="edit-modal-title">✏️ 投稿を編集</h2>
                        <span class="edit-status-badge" id="edit-status-badge">未編集</span>
                    </div>
                    <div class="fullscreen-tabs">
                        <button class="fullscreen-tab active" data-mode="edit" id="tab-edit">✏️ 編集</button>
                        <button class="fullscreen-tab" data-mode="preview" id="tab-preview">👁️ プレビュー</button>
                    </div>
                    <button class="modal-close" id="close-edit-modal">&times;</button>
                </div>

                <!-- Edit Mode Content -->
                <div class="fullscreen-body" id="edit-mode-content">
                    <div class="fullscreen-layout">
                        <!-- Left: Image -->
                        <div class="fullscreen-image-section">
                            <div class="fullscreen-image-preview" id="edit-image-preview">
                                <span class="photo-placeholder">📷 写真をドロップ</span>
                            </div>
                            <input type="file" id="edit-photo-input" accept="image/*" hidden>
                            <button class="btn btn-secondary"
                                onclick="document.getElementById('edit-photo-input').click()">
                                📷 写真を選択・変更
                            </button>
                        </div>

                        <!-- Right: Form -->
                        <div class="fullscreen-form-section">
                            <!-- Section 1: 基本情報 (Booth Info) -->
                            <div class="collapsible-section" data-section="basic">
                                <div class="section-header">
                                    <div class="section-title">
                                        <span class="section-icon">🏢</span>
                                        <h3>基本情報</h3>
                                        <span class="completion-indicator" id="basic-completion">○</span>
                                    </div>
                                    <button class="section-toggle" aria-label="Toggle section">
                                        <span class="toggle-icon">▼</span>
                                    </button>
                                </div>
                                <div class="section-content">
                                    <!-- Template Selector -->
                                    <div class="template-selector-section">
                                        <div class="form-row" style="align-items: flex-end;">
                                            <div class="form-group" style="flex: 1;">
                                                <label for="booth-template-select">ブーステンプレート</label>
                                                <select id="booth-template-select">
                                                    <option value="">-- テンプレートを選択 --</option>
                                                </select>
                                            </div>
                                            <button class="btn btn-ghost btn-small" id="save-booth-template-btn"
                                                title="現在のブース情報をテンプレートとして保存">
                                                💾 保存
                                            </button>
                                            <button class="btn btn-ghost btn-small" id="manage-templates-btn"
                                                title="テンプレートを管理">
                                                ⚙️
                                            </button>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="edit-booth-name">ブース名</label>
                                        <input type="text" id="edit-booth-name" placeholder="SEGA">
                                    </div>
                                    <div class="form-group">
                                        <label for="edit-booth-account">ブース公式@</label>
                                        <input type="text" id="edit-booth-account" placeholder="@SEGA">
                                    </div>
                                    <div class="form-group">
                                        <button class="btn btn-ghost btn-small" id="apply-booth-to-all-btn"
                                            style="width: 100%;">
                                            📋 このブース情報を全ての投稿に適用
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Section 2: 人物情報 (Person Info) -->
                            <div class="collapsible-section" data-section="person">
                                <div class="section-header">
                                    <div class="section-title">
                                        <span class="section-icon">👤</span>
                                        <h3>人物情報</h3>
                                        <span class="completion-indicator" id="person-completion">○</span>
                                    </div>
                                    <button class="section-toggle" aria-label="Toggle section">
                                        <span class="toggle-icon">▼</span>
                                    </button>
                                </div>
                                <div class="section-content">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="edit-person-role">役割</label>
                                            <select id="edit-person-role">
                                                <option value="モデル">モデル</option>
                                                <option value="コスプレイヤー">コスプレイヤー</option>
                                                <option value="イベントコンパニオン">イベントコンパニオン</option>
                                                <option value="RQ">RQ</option>
                                                <option value="アンバサダー">アンバサダー</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="edit-person-name">名前</label>
                                        <input type="text" id="edit-person-name" placeholder="世森 響">
                                    </div>
                                    <div class="form-group">
                                        <label for="edit-person-account">Xアカウント</label>
                                        <input type="text" id="edit-person-account" placeholder="@hibikiyomori">
                                    </div>
                                </div>
                            </div>

                            <!-- Section 3: コメント (Comment) -->
                            <div class="collapsible-section" data-section="comment">
                                <div class="section-header">
                                    <div class="section-title">
                                        <span class="section-icon">💬</span>
                                        <h3>コメント</h3>
                                        <span class="completion-indicator" id="comment-completion">○</span>
                                    </div>
                                    <button class="section-toggle" aria-label="Toggle section">
                                        <span class="toggle-icon">▼</span>
                                    </button>
                                </div>
                                <div class="section-content">
                                    <div class="form-row" style="align-items: flex-end;">
                                        <div class="form-group">
                                            <label for="edit-expression-type">表情</label>
                                            <select id="edit-expression-type">
                                                <option value="笑顔">😊 笑顔</option>
                                                <option value="クール">😎 クール</option>
                                                <option value="柔らか">🌸 柔らか</option>
                                                <option value="華やか">✨ 華やか</option>
                                                <option value="自然">🍃 自然体</option>
                                                <option value="力強い">💪 力強い</option>
                                            </select>
                                        </div>
                                        <button class="btn btn-accent" id="edit-generate-comment-btn">
                                            ✨ コメント生成
                                        </button>
                                    </div>
                                    <textarea id="edit-ai-comment" placeholder="一言コメント..." rows="3"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Preview Mode Content -->
                <div class="fullscreen-body" id="preview-mode-content" style="display: none;">
                    <div class="fullscreen-preview-layout">
                        <div class="preview-image-large" id="preview-image-large">
                            <span class="photo-placeholder">画像なし</span>
                        </div>
                        <div class="preview-text-container">
                            <!-- ドラフト -->
                            <div class="preview-card-large preview-card-full">
                                <div class="preview-header">
                                    <span class="preview-icon">📝</span>
                                    <span class="preview-title">ドラフト</span>
                                </div>
                                <div class="preview-content-large" id="edit-preview-x1"></div>
                                <button class="btn btn-copy" onclick="copyPreviewText('edit-preview-x1')">📋
                                    コピー</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <div class="fullscreen-footer">
                    <button class="btn btn-ghost" id="cancel-edit-btn">キャンセル</button>
                    <button class="btn btn-primary btn-large" id="save-edit-btn">💾 保存してプレビューへ</button>
                </div>
            </div>
        </div>

        <!-- SNS Preview Editor Modal (Full Screen) -->
        <div class="modal fullscreen-modal" id="preview-editor-modal">
            <div class="fullscreen-modal-content preview-editor">
                <!-- Header with mode switching -->
                <div class="fullscreen-header preview-editor-header">
                    <div class="fullscreen-title">
                        <h2>🎨 SNSプレビューエディター</h2>
                    </div>
                    <div class="preview-editor-modes">
                        <button class="mode-btn active" data-mode="both" id="mode-both">
                            <span class="mode-icon">⬜⬜</span> 両方表示
                        </button>
                        <button class="mode-btn" data-mode="image" id="mode-image">
                            <span class="mode-icon">🖼️</span> 画像のみ
                        </button>
                        <button class="mode-btn" data-mode="text" id="mode-text">
                            <span class="mode-icon">📝</span> テキストのみ
                        </button>
                    </div>
                    <button class="modal-close" id="close-preview-editor">×</button>
                </div>

                <!-- Editor Panels -->
                <div class="fullscreen-body preview-editor-body">
                    <div class="preview-editor-panels" data-active-mode="both">
                        <!-- Left Panel: Image Editor -->
                        <div class="editor-panel image-editor-panel" id="image-editor-panel">
                            <div class="panel-toolbar">
                                <span class="panel-title">🖼️ 画像編集</span>
                                <div class="toolbar-actions">
                                    <button class="btn btn-ghost btn-small" id="image-reset-btn">↩️ リセット</button>
                                </div>
                            </div>
                            <div class="image-preview-container" id="image-preview-container">
                                <img id="editor-image" src="" alt="編集画像" style="display: none;">
                                <div class="image-placeholder" id="editor-image-placeholder">
                                    <span class="placeholder-icon">📷</span>
                                    <p>画像をドラッグ＆ドロップ</p>
                                    <p class="placeholder-hint">または下の「画像を選択」をクリック</p>
                                </div>
                            </div>
                            <input type="file" id="editor-image-input" accept="image/*" hidden>
                            <div class="image-controls">
                                <button class="btn btn-secondary" id="editor-image-select">📷 画像を選択</button>
                                <div class="image-tools">
                                    <!-- Basic tools - Phase 3 will expand these -->
                                    <button class="tool-btn" id="tool-crop" title="トリミング">✂️</button>
                                    <button class="tool-btn" id="tool-rotate" title="回転">🔄</button>
                                    <button class="tool-btn" id="tool-flip" title="反転">↔️</button>
                                </div>
                            </div>
                            <div class="image-adjustments">
                                <div class="adjustment-slider">
                                    <label>☀️ 明るさ</label>
                                    <input type="range" id="adjust-brightness" min="-100" max="100" value="0">
                                    <span class="slider-value" id="brightness-value">0</span>
                                </div>
                                <div class="adjustment-slider">
                                    <label>🎨 コントラスト</label>
                                    <input type="range" id="adjust-contrast" min="-100" max="100" value="0">
                                    <span class="slider-value" id="contrast-value">0</span>
                                </div>
                                <div class="adjustment-slider">
                                    <label>🌈 彩度</label>
                                    <input type="range" id="adjust-saturation" min="-100" max="100" value="0">
                                    <span class="slider-value" id="saturation-value">0</span>
                                </div>
                            </div>
                            <button class="btn btn-primary" id="apply-image-to-draft">✓ ドラフトに適用</button>
                        </div>

                        <!-- Right Panel: Text Editor (X-style) -->
                        <div class="editor-panel text-editor-panel" id="text-editor-panel">
                            <div class="panel-toolbar">
                                <span class="panel-title">📝 投稿テキスト</span>
                                <div class="char-counter">
                                    <span id="char-count">0</span> / 280
                                </div>
                            </div>

                            <!-- X-style post preview/editor -->
                            <div class="x-post-editor">
                                <div class="x-post-header">
                                    <div class="x-avatar">📸</div>
                                    <div class="x-user-info">
                                        <span class="x-display-name">Event Photo</span>
                                        <span class="x-handle">@your_handle</span>
                                    </div>
                                </div>

                                <div class="x-post-content">
                                    <div class="x-post-text" contenteditable="true" id="x-post-text-editor"
                                        placeholder="投稿内容をここに入力..."></div>

                                    <div class="x-post-media" id="x-post-media">
                                        <!-- Image thumbnail will appear here -->
                                        <div class="media-placeholder">画像プレビュー</div>
                                    </div>
                                </div>

                                <div class="x-post-toolbar">
                                    <div class="toolbar-left">
                                        <button class="x-tool-btn" id="insert-emoji" title="絵文字">😀</button>
                                        <button class="x-tool-btn" id="insert-hashtag" title="ハッシュタグ">#️⃣</button>
                                        <button class="x-tool-btn" id="insert-mention" title="メンション">@</button>
                                        <button class="x-tool-btn" id="insert-template" title="テンプレート">📋</button>
                                    </div>
                                    <div class="toolbar-right">
                                        <span class="char-warning" id="char-warning" style="display: none;">⚠️
                                            文字数超過</span>
                                    </div>
                                </div>
                            </div>

                            <div class="text-editor-actions">
                                <button class="btn btn-secondary" id="copy-post-text">📋 テキストをコピー</button>
                                <button class="btn btn-primary" id="save-post-text">💾 保存</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <div class="fullscreen-footer preview-editor-footer">
                    <button class="btn btn-ghost" id="cancel-preview-editor">キャンセル</button>
                    <button class="btn btn-primary btn-large" id="save-preview-editor">💾 変更を保存</button>
                </div>
            </div>
        </div>

        <!-- X-Style Preview Modal -->
        <div class="modal" id="x-preview-modal">
            <div class="modal-content x-preview-content">
                <div class="modal-header x-header">
                    <button class="modal-close" id="close-x-preview">&times;</button>
                    <h2>投稿プレビュー</h2>
                    <button class="btn btn-primary btn-small" id="modal-post-btn">ポストする</button>
                </div>
                <div class="x-post-composer">
                    <div class="x-user-area">
                        <div class="x-avatar">📸</div>
                        <div class="x-user-input">
                            <div class="x-post-text" id="modal-post-text"></div>
                        </div>
                    </div>
                    <div class="x-media-preview" id="modal-media-preview">
                        <!-- Image will be inserted here -->
                    </div>
                </div>
                <div class="x-modal-actions">
                    <button class="btn btn-secondary" id="modal-copy-btn">📋 テキストをコピー</button>
                    <button class="btn btn-ghost" id="modal-copy-all-btn">🖼️ 画像を新規タブで開く</button>
                </div>
            </div>
        </div>

        <!-- Bulk Text Parser Preview Modal -->
        <div class="modal fullscreen-modal" id="bulk-parser-modal">
            <div class="fullscreen-modal-content">
                <div class="fullscreen-header">
                    <div class="fullscreen-title">
                        <h2>📋 一括テキスト解析プレビュー</h2>
                        <span class="edit-status-badge" id="parser-format-badge">unknown</span>
                    </div>
                    <button class="modal-close" id="close-parser-modal">&times;</button>
                </div>

                <div class="fullscreen-body">
                    <div class="parser-preview-container">
                        <!-- Warnings Section -->
                        <div class="parser-warnings" id="parser-warnings" style="display: none;">
                            <div class="warning-icon">⚠️</div>
                            <div class="warning-messages" id="parser-warning-messages"></div>
                        </div>

                        <!-- Parsed Entries -->
                        <div class="parser-entries" id="parser-entries">
                            <!-- Entries will be rendered here -->
                        </div>
                    </div>
                </div>

                <div class="fullscreen-footer">
                    <button class="btn btn-ghost" id="cancel-parser-btn">キャンセル</button>
                    <button class="btn btn-primary btn-large" id="apply-parser-btn">✓ 適用して投稿を作成</button>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div class="modal" id="settings-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>⚙️ 設定</h2>
                    <button class="modal-close" id="close-settings">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="make-webhook-url">Make.com Webhook URL</label>
                        <input type="text" id="make-webhook-url" placeholder="https://hook.make.com/...">
                        <small style="color: var(--text-muted); margin-top: 4px;">※ 設定は開発者から受け取ってください</small>
                    </div>
                    <button class="btn btn-primary" id="save-settings-btn">保存</button>
                </div>
            </div>
        </div>

        <!-- Save Template Dialog -->
        <div class="modal" id="save-template-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>💾 テンプレートを保存</h2>
                    <button class="modal-close" id="close-save-template">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="template-name">テンプレート名</label>
                        <input type="text" id="template-name" placeholder="例: TGS - SEGA">
                    </div>
                    <div class="form-group">
                        <label for="template-category">カテゴリ</label>
                        <select id="template-category">
                            <option value="">-- カテゴリを選択 --</option>
                            <option value="TGS">TGS</option>
                            <option value="レース">レース</option>
                            <option value="展示会">展示会</option>
                            <option value="その他">その他</option>
                        </select>
                    </div>
                    <div class="template-preview">
                        <strong>保存される内容:</strong>
                        <div id="template-preview-content"></div>
                    </div>
                    <button class="btn btn-primary" id="confirm-save-template-btn">保存</button>
                </div>
            </div>
        </div>

        <!-- Manage Templates Modal -->
        <div class="modal" id="manage-templates-modal">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2>⚙️ テンプレート管理</h2>
                    <button class="modal-close" id="close-manage-templates">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="templates-list" id="templates-list">
                        <!-- Templates will be rendered here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Batch Progress Modal -->
        <div class="modal" id="batch-progress-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="batch-progress-title">⏳ 処理中...</h2>
                </div>
                <div class="modal-body">
                    <div class="batch-progress-info">
                        <div class="progress-stats">
                            <div class="progress-stat">
                                <span class="progress-label">進捗:</span>
                                <span class="progress-value" id="batch-progress-text">0 / 0</span>
                            </div>
                            <div class="progress-stat">
                                <span class="progress-label">成功:</span>
                                <span class="progress-value success" id="batch-success-count">0</span>
                            </div>
                            <div class="progress-stat">
                                <span class="progress-label">失敗:</span>
                                <span class="progress-value error" id="batch-failed-count">0</span>
                            </div>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="batch-progress-bar"></div>
                        </div>
                        <div class="progress-current" id="batch-current-item"></div>
                    </div>
                    <div class="batch-errors" id="batch-errors" style="display: none;">
                        <h4>エラー詳細:</h4>
                        <ul id="batch-error-list"></ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="batch-cancel-btn">キャンセル</button>
                    <button class="btn btn-primary" id="batch-close-btn" style="display: none;">閉じる</button>
                </div>
            </div>
        </div>

        <!-- Bulk Apply Modal -->
        <div class="modal" id="bulk-apply-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="bulk-apply-title">🏢 一括適用</h2>
                    <button class="modal-close" id="close-bulk-apply">&times;</button>
                </div>
                <div class="modal-body">
                    <p id="bulk-apply-description">選択した投稿に適用します</p>
                    <div class="form-group" id="bulk-apply-booth-fields">
                        <label for="bulk-booth-name">ブース名</label>
                        <input type="text" id="bulk-booth-name" placeholder="ブース名を入力">
                    </div>
                    <div class="form-group" id="bulk-apply-account-field">
                        <label for="bulk-booth-account">ブースアカウント（オプション）</label>
                        <input type="text" id="bulk-booth-account" placeholder="@アカウント">
                    </div>
                    <div class="form-group" id="bulk-apply-role-field" style="display: none;">
                        <label for="bulk-role">役割</label>
                        <select id="bulk-role">
                            <option value="モデル">モデル</option>
                            <option value="RQ">RQ</option>
                            <option value="コンパニオン">コンパニオン</option>
                            <option value="スタッフ">スタッフ</option>
                            <option value="その他">その他</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-ghost" id="cancel-bulk-apply">キャンセル</button>
                    <button class="btn btn-primary" id="confirm-bulk-apply">適用</button>
                </div>
            </div>
        </div>

        <!-- History Modal -->
        <div class="modal fullscreen-modal" id="history-modal">
            <div class="fullscreen-modal-content">
                <div class="fullscreen-header">
                    <div class="fullscreen-title">
                        <h2>📜 投稿履歴</h2>
                    </div>
                    <button class="modal-close" id="close-history-modal">&times;</button>
                </div>

                <div class="fullscreen-body">
                    <div class="history-container">
                        <div class="history-list" id="history-list">
                            <!-- History items will be rendered here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Floating Action Bar -->
        <div class="floating-action-bar" id="floating-action-bar">
            <div class="fab-content">
                <div class="fab-queue-info">
                    <span class="fab-queue-count" id="fab-queue-count">0 / 10</span>
                    <span class="fab-queue-label">投稿</span>
                </div>
                <div class="fab-actions">
                    <button class="btn btn-ghost btn-fab" id="fab-batch-generate-btn" title="一括コメント生成">
                        <span class="fab-icon">✨</span>
                        <span class="fab-text">一括コメント生成</span>
                    </button>
                    <button class="btn btn-ghost btn-fab" id="fab-clear-all-btn" title="全てクリア">
                        <span class="fab-icon">🗑️</span>
                        <span class="fab-text">全てクリア</span>
                    </button>
                    <button class="btn btn-primary btn-fab" id="fab-send-all-btn" title="一括送信">
                        <span class="fab-icon">📤</span>
                        <span class="fab-text">一括送信</span>
                    </button>
                </div>
            </div>
            <button class="fab-toggle" id="fab-toggle" title="折りたたみ">
                <span class="fab-toggle-icon">▼</span>
            </button>
        </div>

        <!-- Settings Button -->
        <button class="settings-btn" id="open-settings">⚙️</button>

        <!-- Toast Notification -->
        <div class="toast" id="toast"></div>

        <!-- Keyboard Shortcut Hint -->
        <div class="keyboard-hint" id="keyboard-hint">
            <span>⌨️ ? でショートカット一覧</span>
        </div>
    </div>

    <script type="module" src="batch-processor.js"></script>
    <script type="module" src="batch-ui.js"></script>
    <script type="module" src="app.js"></script>
</body>

</html>